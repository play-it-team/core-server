dist: xenial
language: python
python:
  - "3.5"
  - "3.6"
  - "3.7"

services:
  - postgresql


before_install:
  - export DJANGO_SETTINGS_MODULE=core.settings.test
  - sudo apt update
  - sudo apt install -y gdal-bin libgdal-dev python3-gdal binutils libproj-dev postgresql-10-postgis-2.4 postgis

before_script:
  - psql -c "CREATE DATABASE travisci;" -U postgres
  - cp .env.test .env
  - cp .admins.example .admins

install:
  - pip install -r requirements/test.txt

script:
  - python manage.py makemigrations
  - python manage.py migrate
  - python manage.py check
  - coverage run --source='.' manage.py test area
  - coverage report
  - coverage xml
  - python-codacy-coverage -r coverage.xml
